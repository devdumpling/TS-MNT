# RepositoryScanner

## Introduction

The Repository Scanner is a crucial component of the TypeScript Modularity Measurement Tool (TS-MMT). It scans the TypeScript repository to identify TypeScript files, React components, and their dependencies. This document provides a detailed implementation plan for the Repository Scanner.

## Implementation Overview

The Repository Scanner will be implemented as a TypeScript module, using the TypeScript Compiler API, Node.js file system APIs, and regular expressions for code analysis and traversal. The module will export a class `RepositoryScanner` with the following methods:

1. `scanRepository(rootPath: string): Promise<ScannedRepository>`
2. `findTypeScriptFiles(path: string): Promise<string[]>`
3. `extractReactComponents(filePath: string): Promise<Component[]>`
4. `extractDependencies(filePath: string): Promise<string[]>`

### Data Structures

We will define the following data structures to store the scanning results:

- `ScannedRepository`: An object that represents the scanned repository, containing an array of `Component` objects.
- `Component`: An object representing a React component, including its name, file path, and dependencies (as an array of strings).

### scanRepository

The `scanRepository(rootPath: string)` method will be the primary method to initiate the scanning process. It will take the root path of the TypeScript repository as an input and return a `Promise<ScannedRepository>` object.

The method will perform the following steps:

1. Call `findTypeScriptFiles` to traverse the file structure and identify TypeScript files.
2. Iterate over the TypeScript files and call `extractReactComponents` to identify React components in each file.
3. For each identified React component, call `extractDependencies` to obtain the component's dependencies.
4. Create a `ScannedRepository` object with the extracted components and their dependencies.

### findTypeScriptFiles

The `findTypeScriptFiles(path: string)` method will take a file path as input and return a `Promise<string[]>` containing an array of file paths corresponding to the TypeScript files in the repository.

The method will use Node.js file system APIs (`fs.promises.readdir`, `fs.promises.stat`) to traverse the file structure recursively, filtering for files with `.ts` or `.tsx` extensions.

### extractReactComponents

The `extractReactComponents(filePath: string)` method will take a file path as input and return a `Promise<Component[]>` containing an array of `Component` objects identified in the file.

The method will leverage the TypeScript Compiler API to parse the TypeScript file, iterate through the syntax tree, and identify React components based on their class or functional component declarations. The method will create a `Component` object for each identified React component, including the component name and file path.

### extractDependencies

The `extractDependencies(filePath: string)` method will take a file path as input and return a `Promise<string[]>` containing an array of imported module names.

The method will read the TypeScript file using Node.js file system APIs (`fs.promises.readFile`) and use regular expressions to extract import statements. Then, it will parse the import statements to obtain the module names.

## Error Handling and Logging

The Repository Scanner should handle errors gracefully and provide useful logs to indicate the progress and potential issues during the scanning process. Consider using a logging library (e.g., `winston`, `pino`) to log messages with different log levels (e.g., `info`, `warn`, `error`).

## Testing

Unit tests should be written to cover the functionality of the Repository Scanner. Use a testing framework like `jest` or `mocha` with a test runner like `ts-node`. Test cases should cover various scenarios, including:

1. Valid and invalid repository structures
2. Different types of React components (class components, functional components)
3. Components with various import statement styles and patterns
4. Handling of circular dependencies and edge cases

## Integration

The Repository Scanner will be integrated with the other components of TS-MMT, such as the Cohesion Analyzer, Coupling Analyzer, Dependency Visualizer, and Modularity Reporter. The `ScannedRepository` object generated by the `scanRepository` method will serve as input to these components.

## Performance Considerations

The Repository Scanner should be optimized for performance, especially when scanning large repositories. Consider using caching techniques to store the results of intermediate operations, such as the results of the `findTypeScriptFiles` method, to avoid redundant processing.

Additionally, consider using asynchronous programming and parallelization techniques to improve performance. For example, the `extractReactComponents` and `extractDependencies` methods could be executed concurrently for different files using `Promise.all`.

## Conclusion

The Repository Scanner is a vital component of the TypeScript Modularity Measurement Tool (TS-MMT), responsible for identifying TypeScript files, React components, and their dependencies. By implementing the Repository Scanner as described in this document, we can build a robust foundation for the TS-MMT, enabling it to effectively analyze TypeScript repositories and provide valuable insights into their modularity.
